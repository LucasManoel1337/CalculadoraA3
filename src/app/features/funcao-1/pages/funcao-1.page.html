<div class="page-container">
  <h2 class="titulo-pagina">Tela Função 1º Grau</h2>

  <div class="content-container">

    <app-display label="a · x + b" [value]="display"></app-display>

    <div class="campo-atual">
      Campo selecionado: <span>{{ campoAtual | uppercase }}</span>
    </div>

    <div class="coeficientes-row">
      <div
        class="coef-box"
        [class.ativo]="campoAtual === 'a'"
        (click)="selecionarCampo('a')">
        <div class="coef-label">a</div>
        <div class="coef-valor">{{ aValor || '—' }}</div>
      </div>

      <div
        class="coef-box"
        [class.ativo]="campoAtual === 'x'"
        (click)="selecionarCampo('x')">
        <div class="coef-label">x</div>
        <div class="coef-valor">{{ xValor || '—' }}</div>
      </div>

      <div
        class="coef-box"
        [class.ativo]="campoAtual === 'b'"
        (click)="selecionarCampo('b')">
        <div class="coef-label">b</div>
        <div class="coef-valor">{{ bValor || '—' }}</div>
      </div>
    </div>

    <div class="botoes-container">
      <button (click)="adicionar('7')">7</button>
      <button (click)="adicionar('8')">8</button>
      <button (click)="adicionar('9')">9</button>
      <button class="apagar-btn" (click)="apagarUltimo()">←</button>

      <button (click)="adicionar('4')">4</button>
      <button (click)="adicionar('5')">5</button>
      <button (click)="adicionar('6')">6</button>
      <button class="clear-btn" (click)="limpar()">C</button>

      <button (click)="adicionar('1')">1</button>
      <button (click)="adicionar('2')">2</button>
      <button (click)="adicionar('3')">3</button>
      <button class="calcular-btn" (click)="calcular()">=</button>

      <button class="zero-btn" (click)="adicionar('0')">0</button>
      <button (click)="adicionar('.')">.</button>
      <button (click)="adicionar('-')">-</button>
    </div>

    @if (resultado) {
      <div class="resultado-container">
        <h2 class="sub-title">Resultado</h2>

        <p class="resultado-linha">
          f(x) = {{ valores.a }} · x + {{ valores.b }}
        </p>

        <p class="resultado-linha">
          Para x = {{ valores.x }}, temos f(x) = {{ resultado.y }}.
        </p>

        @if (resultado.eFuncao1Grau) {
          <p class="resultado-linha">
            Raiz da função (f(x) = 0): x = {{ resultado.raiz }}.
          </p>
        } @else {
          <p class="resultado-linha">
            Como a = 0, não é uma função do 1º grau (não há raiz definida).
          </p>
        }

        <div class="grafico-container">
          <h3 class="grafico-titulo">Gráfico da função</h3>
          <svg
            [attr.viewBox]="'0 0 ' + graphWidth + ' ' + graphHeight"
            preserveAspectRatio="none">
            @for (xTick of gridXTicks; track xTick) {
              <line
                [attr.x1]="toScreenX(xTick)"
                [attr.y1]="0"
                [attr.x2]="toScreenX(xTick)"
                [attr.y2]="graphHeight"
                class="grid-line" />
            }
            @for (yTick of gridYTicks; track yTick) {
              <line
                [attr.x1]="0"
                [attr.y1]="toScreenY(yTick)"
                [attr.x2]="graphWidth"
                [attr.y2]="toScreenY(yTick)"
                class="grid-line" />
            }
            @if (eixoX) {
              <line
                [attr.x1]="eixoX.x1"
                [attr.y1]="eixoX.y1"
                [attr.x2]="eixoX.x2"
                [attr.y2]="eixoX.y2"
                class="axis-line" />
            }
            @if (eixoY) {
              <line
                [attr.x1]="eixoY.x1"
                [attr.y1]="eixoY.y1"
                [attr.x2]="eixoY.x2"
                [attr.y2]="eixoY.y2"
                class="axis-line" />
            }
            <path
              [attr.d]="graphPath"
              class="graph-line" />
          </svg>
          <div class="grafico-legenda">
            Intervalo de x: {{ intervaloX.min }} até {{ intervaloX.max }} |
            Intervalo aproximado de y:
            {{ intervaloY.min | number:'1.0-2' }}
            até
            {{ intervaloY.max | number:'1.0-2' }}
          </div>
        </div>
      </div>
    }

  </div>
</div>
